<!DOCTYPE html>

<html>
<head>
  <title>UDCSpec.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>UDCSpec.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> requirejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'requirejs'</span>),
    expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).expect;

requirejs.config(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./requireConfig.js'</span>));

describe(<span class="hljs-string">'UDC'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-keyword">var</span> UDC;

  it(<span class="hljs-string">'should load the AMD module'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    requirejs([<span class="hljs-string">'udc'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_UDC)</span> {</span>
      UDC = _UDC;
      done();
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="overview">Overview</h1>
<p>Tasks:</p>
<ul>
<li>load data cube</li>
<li>load thesauruss into a thesaurus</li>
<li>query for values</li>
<li>load hierarchy</li>
<li>merge hierarchies</li>
<li>slice</li>
<li>merge data cubes</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h1 id="user-guide">User Guide</h1>
<p>The Universal Data Cube (UDC) library is for modeling data sets
as data cubes and integrating them together. The UDC has two kinds of elements:</p>
<ul>
<li>‘universal elements’ are shared by all data sets</li>
<li>‘local elements’ are local to each data set</li>
</ul>
<p>By establishing a relationship between local elements and universal elements, the
UDC library is able to integrate many data sets together that may:</p>
<ul>
<li>refer to the same entities using different identifiers, or</li>
<li>express the same numeric field using a different scale factor.</li>
</ul>
<h2 id="table">Table</h2>
<p>In the UDC library, the notion of a ‘table’ is a set of <code>row</code> objects
(e.g. rows parsed from a CSV file) and some additional metadata that states 
how the row objects relate to universal elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> tables = {};

  tables.countryPopulations = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <ul>
<li><code>table.rows</code> an array of <code>row</code> objects where<ul>
<li>Keys are column names</li>
<li>Values are numbers or strings</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'rows'</span>: [
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'in'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">1.237</span> },
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'cn'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">1.351</span> },
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'us'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">0.3139</span> }
    ],</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <ul>
<li><code>table.dimensionColumns</code> an array of <code>dimensionColumn</code> objects that 
describe how columns in the table relate to dimensions.<ul>
<li><code>column</code> the column name (key in <code>row</code> objects)</li>
<li><code>dimension</code> the name of the dimension</li>
<li><code>codeList</code> the name of the code list used by <code>row</code> objects.
For each <code>row</code> in <code>table.rows</code>, <code>row[column]</code> yields a string 
that is a code from this code list.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'dimensionColumns'</span>: [
      {
        <span class="hljs-string">'column'</span>: <span class="hljs-string">'Country'</span>,
        <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
        <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryCode'</span>
      }
    ],</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <ul>
<li><code>table.measureColumns</code> an array of <code>measureColumn</code> objects that 
describe how columns in the table relate to measures.<ul>
<li><code>column</code> the column name (key in <code>row</code> objects)</li>
<li><code>measure</code> the name of the measure</li>
<li><code>scale</code> the scale factor used by values.
For each <code>row</code> in <code>table.rows</code>, <code>row[column]</code> yields a number <code>x</code> 
such that <br> <code>x * scale</code> yields the measure value.</li>
</ul>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'measureColumns'</span>: [
      {
        <span class="hljs-string">'column'</span>: <span class="hljs-string">'Pop'</span>,
        <span class="hljs-string">'measure'</span>: <span class="hljs-string">'Population'</span>,
        <span class="hljs-string">'scale'</span>: <span class="hljs-number">1000000000</span>
      }
    ]
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Tables are used as input for creating cubes and thesauruss.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tables.countryGDP = {
    <span class="hljs-string">'rows'</span>: [
      { <span class="hljs-string">'name'</span>: <span class="hljs-string">'China'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">12261</span> },
      { <span class="hljs-string">'name'</span>: <span class="hljs-string">'India'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">4716</span> },
      { <span class="hljs-string">'name'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">16244</span> }
    ],
    <span class="hljs-string">'dimensionColumns'</span>: [
      {
        <span class="hljs-string">'column'</span>: <span class="hljs-string">'name'</span>,
        <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
        <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>
      }
    ],
    <span class="hljs-string">'measureColumns'</span>: [
      {
        <span class="hljs-string">'column'</span>: <span class="hljs-string">'gdp'</span>,
        <span class="hljs-string">'measure'</span>: <span class="hljs-string">'Gross Domestic Product'</span>,
        <span class="hljs-string">'scale'</span>: <span class="hljs-number">1000</span>
      }
    ]
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="cube">Cube</h2>
<p>Data cubes are referred to as ‘cubes’. A cube is a data set
that comes from a table that includes columns for dimensions
and measures.</p>
<ul>
<li>dimensions are sets of discrete entities</li>
<li>measures are aggregated numeric properties</li>
</ul>
<p>One example of cube is a data set that contains values for
population (number of people) in each of the three largest
countries of the world - China (ch), India (in) and the USA (us).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'should load a data cube'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> table = tables.countryPopulations,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><code>UDC.Cube(table)</code> is the constructor function for cubes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cube = UDC.Cube(table),

        index = UDC.CubeIndex(cube.observations),</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><code>cube.values(cell)</code> queries the cube for values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        cell = UDC.Cell([UDC.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>)]),
        measure = <span class="hljs-string">'Population'</span>,
        value = index.values(cell)[measure];

    expect(value).to.equal(<span class="hljs-number">1.237</span> * <span class="hljs-number">1000000000</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="thesaurus">Thesaurus</h2>
<p>Thesaurus tables are tables that provide equivalence mappings
between codes from different code lists. A collection of thesaurus
tables can be assembled into an equivalence index called a thesaurus.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tables.countryNamesAndCodes = {
    <span class="hljs-string">'dimensionColumns'</span>: [
      { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'Country'</span> },
      { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'Code'</span> }
    ],
    <span class="hljs-string">'rows'</span>: [
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'India'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'in'</span> },
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'China'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'cn'</span> },
      { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'us'</span> }
    ]
  };
  tables.unUsLocations = {
    <span class="hljs-string">'dimensionColumns'</span>: [
      { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'unName'</span> },
      { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'usLocationName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'usName'</span> }
    ],
    <span class="hljs-string">'rows'</span>: [
      { <span class="hljs-string">'unName'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'usName'</span>: <span class="hljs-string">'USA'</span> }
    ]
  };

  it(<span class="hljs-string">'should load a thesaurus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> table = tables.countryNamesAndCodes,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><code>UDC.Thesaurus([tables])</code> is the thesaurus constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        thesaurus = UDC.Thesaurus([table]),
        codeMember = UDC.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>),
        nameMember = thesaurus.translate(codeMember, <span class="hljs-string">'countryName'</span>);

    expect(nameMember.codeList).to.equal(<span class="hljs-string">'countryName'</span>);
    expect(nameMember.code).to.equal(<span class="hljs-string">'India'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="hierarchies">Hierarchies</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> trees = {};
  trees.unLocations = {
   <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
   <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>,
   <span class="hljs-string">'code'</span>: <span class="hljs-string">'World'</span>,
   <span class="hljs-string">'children'</span>: [
    {
     <span class="hljs-string">'code'</span>: <span class="hljs-string">'Asia'</span>,
     <span class="hljs-string">'children'</span>: [
      {
       <span class="hljs-string">'code'</span>: <span class="hljs-string">'Southern Asia'</span>,
       <span class="hljs-string">'children'</span>: [
        {<span class="hljs-string">'code'</span>: <span class="hljs-string">'India'</span>},
       ]
      },
      {
       <span class="hljs-string">'code'</span>: <span class="hljs-string">'Eastern Asia'</span>,
       <span class="hljs-string">'children'</span>: [
        {<span class="hljs-string">'code'</span>: <span class="hljs-string">'China'</span>},
       ]
      }
     ]
    },
    {
     <span class="hljs-string">'code'</span>: <span class="hljs-string">'Americas'</span>,
     <span class="hljs-string">'children'</span>: [
      {
       <span class="hljs-string">'code'</span>: <span class="hljs-string">'Northern America'</span>,
       <span class="hljs-string">'children'</span>: [
        {<span class="hljs-string">'code'</span>: <span class="hljs-string">'United States of America'</span>}
       ]
      }
     ]
    }
   ]
  };
  trees.usLocations = {
   <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
   <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'usLocationName'</span>,
   <span class="hljs-string">'code'</span>: <span class="hljs-string">'USA'</span>,
   <span class="hljs-string">'children'</span>: [
    { <span class="hljs-string">'code'</span>: <span class="hljs-string">'California'</span> },
    { <span class="hljs-string">'code'</span>: <span class="hljs-string">'Texas'</span> },
    { <span class="hljs-string">'code'</span>: <span class="hljs-string">'New York'</span> }
   ]
  };

  it(<span class="hljs-string">'should load a hierarchy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>UDC.Hierarchy(tree)</code> is the hierarchy constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> hierarchy = UDC.Hierarchy(trees.unLocations);
    expect(hierarchy.dimension).to.equal(<span class="hljs-string">'Space'</span>);
    expect(hierarchy.tree.member.key).to.equal(<span class="hljs-string">'countryName|World'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|India'</span>);
  });

  it(<span class="hljs-string">'should merge two hierarchies'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> hierarchyA = UDC.Hierarchy(trees.unLocations),
        hierarchyB = UDC.Hierarchy(trees.usLocations),
        thesaurus = UDC.Thesaurus([tables.unUsLocations]),
        hierarchy = UDC.mergeHierarchies(hierarchyA, hierarchyB, thesaurus);
    expect(hierarchy.dimension).to.equal(<span class="hljs-string">'Space'</span>);
    expect(hierarchy.tree.member.key).to.equal(<span class="hljs-string">'countryName|World'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|India'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">1</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|United States of America'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">1</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'usLocationName|California'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="merging-cubes">Merging Cubes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  it(<span class="hljs-string">'should merge two cubes with the same domain'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> thesaurus = UDC.Thesaurus([tables.countryNamesAndCodes]),
        cubeA = UDC.Cube(tables.countryPopulations),
        cubeB = UDC.Cube(tables.countryGDP),
        <span class="hljs-comment">/* TODO think about API changes: [cubes], [thesauruss]
         *      possibly remove UDC.Thesaurus() constructor?
         *      alternative: thesaurusPool
         * TODO think about reactive models - recanonicalize when thesauruss added.*/</span>
        cube = UDC.mergeCubes(cubeA, cubeB, thesaurus),
        index = UDC.CubeIndex(cube.observations),
        cell = UDC.Cell([UDC.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>)]),
        values = index.values(cell);

    expect(values.Population).to.equal(<span class="hljs-number">1.237</span> * <span class="hljs-number">1000000000</span>);
    expect(values[<span class="hljs-string">'Gross Domestic Product'</span>]).to.equal(<span class="hljs-number">4716</span> * <span class="hljs-number">1000</span>);
  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
