<!DOCTYPE html>

<html>
<head>
  <title>udcTests.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>udcTests.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>TODO slice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> requirejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'requirejs'</span>),
    expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).expect,
    data = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./data.js'</span>);

requirejs.config(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./requireConfig.js'</span>));

describe(<span class="hljs-string">'UDC'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
  <span class="hljs-keyword">var</span> udc;

  it(<span class="hljs-string">'should load required AMD modules'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    requirejs([<span class="hljs-string">'udc'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_udc)</span> {</span>
      udc = _udc;
      done();
    });
  });

  it(<span class="hljs-string">'should load a data cube'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> table = data.tables.countryPopulations,
        cube = udc.Cube(table),
        index = udc.CubeIndex(cube.observations),
        cell = udc.Cell([udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>)]),
        measure = <span class="hljs-string">'Population'</span>,
        value = index.values(cell)[measure];

    expect(value).to.equal(<span class="hljs-number">1.237</span> * <span class="hljs-number">1000000000</span>);
  });

  it(<span class="hljs-string">'should load a thesaurus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> table = data.tables.countryNamesAndCodes,
        thesaurus = udc.Thesaurus([table]),
        codeMember = udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>),
        nameMember = thesaurus.translate(codeMember, <span class="hljs-string">'countryName'</span>);

    expect(nameMember.codeList).to.equal(<span class="hljs-string">'countryName'</span>);
    expect(nameMember.code).to.equal(<span class="hljs-string">'India'</span>);
  });

  it(<span class="hljs-string">'should load a hierarchy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> hierarchy = udc.Hierarchy(data.trees.unLocations);
    expect(hierarchy.dimension).to.equal(<span class="hljs-string">'Space'</span>);
    expect(hierarchy.tree.member.key).to.equal(<span class="hljs-string">'countryName|World'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|India'</span>);
  });

  it(<span class="hljs-string">'should merge two hierarchies'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> hierarchyA = udc.Hierarchy(data.trees.unLocations),
        hierarchyB = udc.Hierarchy(data.trees.usLocations),
        thesaurus = udc.Thesaurus([data.tables.unUsLocations]),
        hierarchy = udc.mergeHierarchies(hierarchyA, hierarchyB, thesaurus);
    expect(hierarchy.dimension).to.equal(<span class="hljs-string">'Space'</span>);
    expect(hierarchy.tree.member.key).to.equal(<span class="hljs-string">'countryName|World'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|India'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">1</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'countryName|United States of America'</span>);
    expect(hierarchy.tree.children[<span class="hljs-number">1</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].children[<span class="hljs-number">0</span>].member.key)
      .to.equal(<span class="hljs-string">'usLocationName|California'</span>);
  });

  it(<span class="hljs-string">'should merge two cubes with the same domain'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> thesaurus = udc.Thesaurus([data.tables.countryNamesAndCodes]),
        cubeA = udc.Cube(data.tables.countryPopulations),
        cubeB = udc.Cube(data.tables.countryGDP),
        cube = udc.mergeCubes(cubeA, cubeB, thesaurus),
        index = udc.CubeIndex(cube.observations),
        cell = udc.Cell([udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'in'</span>)]),
        values = index.values(cell);

    expect(values.Population).to.equal(<span class="hljs-number">1.237</span> * <span class="hljs-number">1000000000</span>);
    expect(values[<span class="hljs-string">'Gross Domestic Product'</span>]).to.equal(<span class="hljs-number">4716</span> * <span class="hljs-number">1000</span>);
  });

  it(<span class="hljs-string">'should load UN population data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    data.load(<span class="hljs-string">'tests/data/total_population'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(table)</span> {</span>
      <span class="hljs-keyword">var</span> cube = udc.Cube(table),
          index = udc.CubeIndex(cube.observations),
          chinaIn1960 = [
            udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'UN M.49'</span>, <span class="hljs-string">'156'</span>),
            udc.Member(<span class="hljs-string">'Time'</span>, <span class="hljs-string">'year'</span>, <span class="hljs-string">'1960'</span>)
          ],
          cell = udc.Cell(chinaIn1960),
          values = index.values(cell);

      expect(values.Population).to.equal(<span class="hljs-number">650680.114</span> * <span class="hljs-number">1000</span>);
      done();
    });
  });
  it(<span class="hljs-string">'should load World Bank GDP data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    data.load(<span class="hljs-string">'tests/data/GDP_current_USD'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(table)</span> {</span>
      <span class="hljs-keyword">var</span> cube = udc.Cube(table),
          index = udc.CubeIndex(cube.observations),
          chinaIn1960 = [
            udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'ISO 3166-1 alpha-3'</span>, <span class="hljs-string">'CHN'</span>),
            udc.Member(<span class="hljs-string">'Time'</span>, <span class="hljs-string">'year'</span>, <span class="hljs-string">'1960'</span>)
          ],
          cell = udc.Cell(chinaIn1960),
          values = index.values(cell);

      expect(values[<span class="hljs-string">'Gross Domestic Product (current US$)'</span>]).to.equal(<span class="hljs-number">61377930682.0013</span>);
      done();
    });
  });
  it(<span class="hljs-string">'should merge UN population data and World Bank DGP data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    data.load(<span class="hljs-string">'tests/data/GDP_current_USD'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tableA)</span> {</span>
      data.load(<span class="hljs-string">'tests/data/total_population'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(tableB)</span> {</span>
        data.load(<span class="hljs-string">'tests/data/locations'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(concordance)</span> {</span>
          <span class="hljs-keyword">var</span> thesaurus = udc.Thesaurus([concordance]),
              cubeA = udc.Cube(tableA),
              cubeB = udc.Cube(tableB),
              cube = udc.mergeCubes(cubeA, cubeB, thesaurus),
              index = udc.CubeIndex(cube.observations),
              chinaIn1960 = [
                udc.Member(<span class="hljs-string">'Space'</span>, <span class="hljs-string">'ISO 3166-1 alpha-3'</span>, <span class="hljs-string">'CHN'</span>),
                udc.Member(<span class="hljs-string">'Time'</span>, <span class="hljs-string">'year'</span>, <span class="hljs-string">'1960'</span>)
              ],
              cell = udc.Cell(chinaIn1960),
              canonicalCell = thesaurus.canonicalizeCell(cell),
              values = index.values(canonicalCell);

          expect(values[<span class="hljs-string">'Gross Domestic Product (current US$)'</span>]).to.equal(<span class="hljs-number">61377930682.0013</span>);
          expect(values.Population).to.equal(<span class="hljs-number">650680.114</span> * <span class="hljs-number">1000</span>);
          done();
        });
      });
    });
  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
