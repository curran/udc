<!DOCTYPE html>

<html>
<head>
  <title>data.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>data.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>),
    data = { tables: {}, trees: {} };

data.tables.countryPopulations = {
  <span class="hljs-string">'rows'</span>: [
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'in'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">1.237</span> },
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'cn'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">1.351</span> },
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'us'</span>, <span class="hljs-string">'Pop'</span>: <span class="hljs-number">0.3139</span> }
  ],
  <span class="hljs-string">'dimensionColumns'</span>: [
    {
      <span class="hljs-string">'column'</span>: <span class="hljs-string">'Country'</span>,
      <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
      <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryCode'</span>
    }
  ],
  <span class="hljs-string">'measureColumns'</span>: [
    {
      <span class="hljs-string">'column'</span>: <span class="hljs-string">'Pop'</span>,
      <span class="hljs-string">'measure'</span>: <span class="hljs-string">'Population'</span>,
      <span class="hljs-string">'scale'</span>: <span class="hljs-number">1000000000</span>
    }
  ]
};
data.tables.countryGDP = {
  <span class="hljs-string">'rows'</span>: [
    { <span class="hljs-string">'name'</span>: <span class="hljs-string">'China'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">12261</span> },
    { <span class="hljs-string">'name'</span>: <span class="hljs-string">'India'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">4716</span> },
    { <span class="hljs-string">'name'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'gdp'</span>: <span class="hljs-number">16244</span> }
  ],
  <span class="hljs-string">'dimensionColumns'</span>: [
    {
      <span class="hljs-string">'column'</span>: <span class="hljs-string">'name'</span>,
      <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
      <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>
    }
  ],
  <span class="hljs-string">'measureColumns'</span>: [
    {
      <span class="hljs-string">'column'</span>: <span class="hljs-string">'gdp'</span>,
      <span class="hljs-string">'measure'</span>: <span class="hljs-string">'Gross Domestic Product'</span>,
      <span class="hljs-string">'scale'</span>: <span class="hljs-number">1000</span>
    }
  ]
};
data.tables.countryNamesAndCodes = {
  <span class="hljs-string">'dimensionColumns'</span>: [
    { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'Country'</span> },
    { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryCode'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'Code'</span> }
  ],
  <span class="hljs-string">'rows'</span>: [
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'India'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'in'</span> },
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'China'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'cn'</span> },
    { <span class="hljs-string">'Country'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'Code'</span>: <span class="hljs-string">'us'</span> }
  ]
};
data.tables.unUsLocations = {
  <span class="hljs-string">'dimensionColumns'</span>: [
    { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'unName'</span> },
    { <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>, <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'usLocationName'</span>, <span class="hljs-string">'column'</span>: <span class="hljs-string">'usName'</span> }
  ],
  <span class="hljs-string">'rows'</span>: [
    { <span class="hljs-string">'unName'</span>: <span class="hljs-string">'United States of America'</span>, <span class="hljs-string">'usName'</span>: <span class="hljs-string">'USA'</span> }
  ]
};
data.trees.unLocations = {
 <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
 <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'countryName'</span>,
 <span class="hljs-string">'code'</span>: <span class="hljs-string">'World'</span>,
 <span class="hljs-string">'children'</span>: [
  {
   <span class="hljs-string">'code'</span>: <span class="hljs-string">'Asia'</span>,
   <span class="hljs-string">'children'</span>: [
    {
     <span class="hljs-string">'code'</span>: <span class="hljs-string">'Southern Asia'</span>,
     <span class="hljs-string">'children'</span>: [
      {<span class="hljs-string">'code'</span>: <span class="hljs-string">'India'</span>},
     ]
    },
    {
     <span class="hljs-string">'code'</span>: <span class="hljs-string">'Eastern Asia'</span>,
     <span class="hljs-string">'children'</span>: [
      {<span class="hljs-string">'code'</span>: <span class="hljs-string">'China'</span>},
     ]
    }
   ]
  },
  {
   <span class="hljs-string">'code'</span>: <span class="hljs-string">'Americas'</span>,
   <span class="hljs-string">'children'</span>: [
    {
     <span class="hljs-string">'code'</span>: <span class="hljs-string">'Northern America'</span>,
     <span class="hljs-string">'children'</span>: [
      {<span class="hljs-string">'code'</span>: <span class="hljs-string">'United States of America'</span>}
     ]
    }
   ]
  }
 ]
};
data.trees.usLocations = {
 <span class="hljs-string">'dimension'</span>: <span class="hljs-string">'Space'</span>,
 <span class="hljs-string">'codeList'</span>: <span class="hljs-string">'usLocationName'</span>,
 <span class="hljs-string">'code'</span>: <span class="hljs-string">'USA'</span>,
 <span class="hljs-string">'children'</span>: [
  { <span class="hljs-string">'code'</span>: <span class="hljs-string">'California'</span> },
  { <span class="hljs-string">'code'</span>: <span class="hljs-string">'Texas'</span> },
  { <span class="hljs-string">'code'</span>: <span class="hljs-string">'New York'</span> }
 ]
};
data.load = loadTable;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadTable</span><span class="hljs-params">(path, callback)</span>{</span>
  loadCSV(path + <span class="hljs-string">'.csv'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rows)</span> {</span>
    loadJSON(path + <span class="hljs-string">'.json'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(table)</span> {</span>
      table.rows = rows;
      callback(table);
    });
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadCSV</span><span class="hljs-params">(path, callback)</span>{</span>
  input(path, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span>{</span>
    callback(parseCSVTable(data));
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadJSON</span><span class="hljs-params">(path, callback)</span>{</span>
  input(path, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span>{</span>
    callback(<span class="hljs-built_in">JSON</span>.parse(data));
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">input</span><span class="hljs-params">(name, callback)</span>{</span>
  fs.readFile(name, <span class="hljs-string">'utf8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err, data)</span> {</span>
    <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
    callback(data);
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseCSVTable</span><span class="hljs-params">(data)</span>{</span>
  <span class="hljs-keyword">var</span> rows = data.split(<span class="hljs-string">'\n'</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(row)</span> {</span>
        <span class="hljs-keyword">return</span> row.length &gt; <span class="hljs-number">0</span>;
      }),
      header = rows.splice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>],
      properties = parseCSVRow(header);
  <span class="hljs-keyword">return</span> rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rowStr)</span> {</span>
    <span class="hljs-keyword">var</span> values = parseCSVRow(rowStr);
    <span class="hljs-keyword">var</span> row = {};
    properties.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(property, i)</span> {</span>
      row[property] = values[i];
    });
    <span class="hljs-keyword">return</span> row;
  });
}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Parse a CSV row, accounting for commas inside quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseCSVRow</span><span class="hljs-params">(row)</span>{</span>
  <span class="hljs-keyword">var</span> insideQuote = <span class="hljs-literal">false</span>,
      entries = [],
      entry = [];
  row.split(<span class="hljs-string">''</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(character)</span> {</span>
    <span class="hljs-keyword">if</span>(character === <span class="hljs-string">'"'</span>) {
      insideQuote = !insideQuote;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span>(character == <span class="hljs-string">","</span> &amp;&amp; !insideQuote) {
        entries.push(entry.join(<span class="hljs-string">''</span>));
        entry = [];
      } <span class="hljs-keyword">else</span> {
        entry.push(character);
      }
    }
  });
  entries.push(entry.join(<span class="hljs-string">''</span>));
  <span class="hljs-keyword">return</span> entries;
}

module.exports = data;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
